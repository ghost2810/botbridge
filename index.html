<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BotBridge Ops - AI-Powered ITSM Automation Platform</title>
  <meta name="description" content="Bridge Your IT Operations with AI-Powered Automation. Reduce MTTR by 42%, achieve 98% SLA compliance, and automate 80% of routine tickets." />
  <link rel="stylesheet" href="style.css" />
  <style>
    :root { --bb-primary:#1f6feb; --bb-bg:#ffffff; --bb-text:#0a0a0a; --bb-muted:#eef2f7; }
    /* Fab button */
    .bb-chat-fab { position: fixed; right: 20px; bottom: 20px; z-index: 9998; border: 0; border-radius: 999px; background: var(--bb-primary); color: #fff; padding: 12px 16px; display: inline-flex; align-items: center; gap: 8px; font-weight: 600; cursor: pointer; box-shadow: 0 10px 24px rgba(0,0,0,.16); }
    .bb-chat-fab:hover { filter: brightness(1.05); }
    .bb-chat-fab svg { width: 18px; height: 18px; }
    /* Modal */
    .bb-modal-backdrop { display: none; position: fixed; inset: 0; background: rgba(0,0,0,.35); z-index: 9998; }
    .bb-modal { position: fixed; right: 20px; bottom: 84px; width: min(420px, 92vw); height: 70vh; max-height: 680px; background: var(--bb-bg); border-radius: 16px; box-shadow: 0 24px 56px rgba(0,0,0,.28); overflow: hidden; display: none; flex-direction: column; z-index: 10000; }
    .bb-modal[hidden] { display: none; }
    .bb-modal:not([hidden]) { display: flex; }
    .bb-modal-header { display:flex; align-items:center; justify-content: space-between; padding: 12px 14px; border-bottom: 1px solid var(--bb-muted); background: #fafbfc; }
    .bb-title { display:flex; align-items:center; gap:10px; font-weight:700; color: var(--bb-text); }
    .bb-close { appearance:none; border:0; background:transparent; cursor:pointer; padding:8px; border-radius:8px; }
    .bb-close:hover { background:#f1f4f8; }
    .bb-chat { flex:1; display:flex; flex-direction:column; }
    .bb-messages { flex:1; overflow:auto; padding: 12px; background: #fff; }
    .bb-msg { margin: 8px 0; padding: 10px 12px; border-radius: 12px; max-width: 85%; line-height: 1.4; }
    .bb-msg.user { margin-left: auto; background: #e8f0ff; }
    .bb-msg.bot { background: #f6f7f9; }
    .bb-input-row { display:flex; gap:8px; padding: 10px; border-top:1px solid var(--bb-muted); background:#fafbfc; }
    .bb-input { flex:1; border:1px solid var(--bb-muted); border-radius: 10px; padding: 10px 12px; font-size: 14px; }
    .bb-send { border:0; background: var(--bb-primary); color:#fff; padding: 10px 14px; border-radius: 10px; font-weight:600; cursor:pointer; }
    .bb-send[disabled] { opacity:.6; cursor:not-allowed; }
    @media (max-width: 480px) {
      .bb-modal { right: 10px; left: 10px; bottom: 90px; width: auto; height: 70vh; }
    }
  </style>
</head>
<body>
  <!-- Existing site content goes here (kept intact) -->

  <!-- Chatbot: Modal + Open Button -->
  <button id="bbOpen" class="bb-chat-fab" aria-controls="bbModal" aria-expanded="false">
    <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"><path fill="currentColor" d="M12 3C7.03 3 3 6.58 3 11c0 2.4 1.2 4.56 3.16 6.08-.1.83-.44 2.18-1.42 3.53 0 0 2.02-.27 3.9-1.7.97.27 2 .42 3.08.42 4.97 0 9-3.58 9-8s-4.03-8-9-8Z"/></svg>
    Chat
  </button>
  <div id="bbBackdrop" class="bb-modal-backdrop" hidden></div>
  <section id="bbModal" class="bb-modal" role="dialog" aria-modal="true" aria-labelledby="bbTitle" hidden>
    <header class="bb-modal-header">
      <div class="bb-title">
        <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"><path fill="#1f6feb" d="M12 2a10 10 0 1 0 .001 20.001A10 10 0 0 0 12 2Zm-1.5 6.75h3a.75.75 0 0 1 0 1.5h-3a.75.75 0 0 1 0-1.5Zm0 5h4a.75.75 0 0 1 0 1.5h-4a.75.75 0 0 1 0-1.5Z"/></svg>
        <span id="bbTitle">BotBridge Assistant</span>
      </div>
      <button id="bbClose" class="bb-close" aria-label="Close chat">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"><path fill="#0a0a0a" d="M6.225 4.811 4.81 6.225 10.586 12 4.81 17.775l1.414 1.414L12 13.414l5.775 5.775 1.414-1.414L13.414 12l5.775-5.775-1.414-1.414L12 10.586 6.225 4.811Z"/></svg>
      </button>
    </header>
    <div class="bb-chat">
      <div id="bbMessages" class="bb-messages" aria-live="polite"></div>
      <div class="bb-input-row">
        <input id="bbInput" class="bb-input" type="text" placeholder="Type your message..." />
        <button id="bbSend" class="bb-send">Send</button>
      </div>
    </div>
  </section>

  <script>
    // Configure these before deploying
    const LYZR_API_URL = 'https://API_URL/agent/chat'; // e.g., https://api.lyzr.ai/v1/agent/chat
    const LYZR_API_KEY = 'YOUR_API_KEY_HERE'; // paste your Lyzr API key
    const LYZR_AGENT_ID = 'YOUR_AGENT_ID_OPTIONAL';

    const $open = document.getElementById('bbOpen');
    const $modal = document.getElementById('bbModal');
    const $backdrop = document.getElementById('bbBackdrop');
    const $close = document.getElementById('bbClose');
    const $messages = document.getElementById('bbMessages');
    const $input = document.getElementById('bbInput');
    const $send = document.getElementById('bbSend');

    function openModal() {
      $modal.hidden = false;
      $backdrop.hidden = false;
      $open.setAttribute('aria-expanded', 'true');
      setTimeout(() => $input && $input.focus(), 50);
    }
    function closeModal() {
      $modal.hidden = true;
      $backdrop.hidden = true;
      $open.setAttribute('aria-expanded', 'false');
    }

    $open.addEventListener('click', openModal);
    $close.addEventListener('click', closeModal);
    $backdrop.addEventListener('click', closeModal);
    document.addEventListener('keydown', (e) => { if (e.key === 'Escape' && !$modal.hidden) closeModal(); });

    function appendMessage(role, text) {
      const div = document.createElement('div');
      div.className = `bb-msg ${role}`;
      div.textContent = text;
      $messages.appendChild(div);
      $messages.scrollTop = $messages.scrollHeight;
    }
    async function sendToLyzr(prompt) {
      const payload = { agent_id: LYZR_AGENT_ID, messages: [{ role: 'user', content: prompt }] };
      const res = await fetch(LYZR_API_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${LYZR_API_KEY}` },
        body: JSON.stringify(payload)
      });
      if (!res.ok) { const errText = await res.text().catch(() => 'Unknown error'); throw new Error(`Request failed: ${res.status} ${errText}`); }
      const data = await res.json();
      const reply = (data?.choices?.[0]?.message?.content) || data?.reply || JSON.stringify(data);
      return reply;
    }
    async function handleSend() {
      const text = $input.value.trim();
      if (!text) return;
      $input.value = '';
      appendMessage('user', text);
      $send.disabled = true;
      try {
        const reply = await sendToLyzr(text);
        appendMessage('bot', reply);
      } catch (e) {
        appendMessage('bot', `Sorry, something went wrong. ${e.message}`);
      } finally {
        $send.disabled = false;
        $input.focus();
      }
    }
    $send.addEventListener('click', handleSend);
    $input.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        handleSend();
      }
    });
  </script>
</body>
</html>
